#model_select
  = label_tag('model', 'For what model do you want to see a summary?')
  = select_tag('model', options_for_select([['Diagram', 'diagrams_usage_summary'], ['User', 'users_usage_summary']]))

#new_or_total_container
  = label_tag('new_or_total', 'Do you want to see the number of model instances created each month, or the total number of model instances at the end of each month?')
  = select_tag('new_or_total', options_for_select(['New', 'Total']))


%h2#table_header
-@summary.each do |model|
  %div.usage_chart{:id => model[:name]+"_chart"}= line_chart model[:data]
  %table.usage_summary{:id => model[:name]}
    %thead
      %tr
        %th Institution
        - model[:month].each do |month|
          %th=month 
    %tbody
      - model[:data].each do |institution|
        %tr
          %td= institution[:name]
          - institution[:data].each do |month,counts|
            %td= counts

:javascript
  var tableHeaders = {};
  ['new', 'total'].forEach(function(new_or_total) {
    ['users', 'diagrams'].forEach(function(model) {
      tableHeaders[new_or_total+"_"+model+"_usage_summary_wrapper"] = new_or_total == 'new' ? 
                                          "Number of new "+model+" added each month by each institution" : 
                                          "Total number of "+model+" in each institution as of the end of each month";
    })
  });

  $(".usage_summary").dataTable();
  $('.dataTables_wrapper').hide(); 
  $('.usage_chart').hide();

  $("#new_diagrams_usage_summary_wrapper").show();
  $("#new_diagrams_usage_summary_chart").show();
  $("#table_header").html(tableHeaders["new_diagrams_usage_summary_wrapper"]);

  $("#model, #new_or_total").on('change', function(e) {
  	console.log($("#model").val());
    var id = $("#new_or_total").val().toLowerCase()+"_"+$("#model").val();
    $(".dataTables_wrapper").hide();
    $('.usage_chart').hide();
    $("#"+ id + "_wrapper").show();
    $("#"+ id + "_chart").show();
    $("#table_header").html(tableHeaders[id+"_wrapper"]);
  });
